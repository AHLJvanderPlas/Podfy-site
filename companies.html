<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Companies – Podfy</title>
  <meta name="description" content="Auto-updating list of companies and theme settings from podfy.app." />
  <link rel="canonical" href="https://podfy.net/companies">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { colors: { brand: { DEFAULT:'#4B5563', accent:'#2563EB' }}}}}
  </script>
  <style>html{scroll-behavior:smooth}</style>
</head>
<body class="bg-white text-slate-800 antialiased">
  <header class="border-b border-slate-100">
    <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3">
        <svg width="28" height="28" viewBox="0 0 64 64" class="text-brand" aria-hidden="true">
          <g fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 22l24-12 24 12v20L32 54 8 42V22Z"/><path d="M32 54V34"/>
            <path d="M14 36h10"/><path d="M24 36l6 4-6 4"/><path d="M38 36l4 5 8-10"/>
          </g>
        </svg>
        <span class="text-lg font-semibold tracking-tight text-brand">Podfy</span>
      </a>
      <nav class="text-sm">
        <a href="/" class="hover:text-brand mr-6">Home</a>
        <a href="/security.html" class="hover:text-brand mr-6">Security</a>
        <a href="/companies" class="text-brand font-medium">Companies</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-10">
    <h1 class="text-3xl font-bold">Companies</h1>
    <p class="mt-2 text-slate-600">Auto-loaded from <code>https://podfy.app/themes.json</code>. New companies appear here automatically.</p>

    <div class="mt-6 flex items-center gap-3">
      <input id="search" placeholder="Filter by slug or name…" class="w-full max-w-md rounded border px-3 py-2 text-sm" />
      <button id="refresh" class="rounded border px-3 py-2 text-sm hover:bg-slate-50">Refresh</button>
    </div>

    <div id="status" class="mt-4 text-sm text-slate-600">Loading…</div>

    <div class="mt-4 overflow-x-auto border rounded-xl">
      <table id="tbl" class="min-w-full text-sm">
        <thead class="bg-slate-50 text-slate-600"></thead>
        <tbody class="divide-y"></tbody>
      </table>
    </div>

    <p class="mt-3 text-xs text-slate-500">Tip: logos and colors are inferred from fields like <code>logo</code>, <code>logoUrl</code>, <code>brandColor</code>, <code>buttonColor</code>.</p>
  </main>

  <script>
    const ENDPOINT = "https://podfy.app/themes.json"; // if CORS blocks, see the proxy option below

    const statusEl = document.getElementById('status');
    const thead = document.querySelector('#tbl thead');
    const tbody = document.querySelector('#tbl tbody');
    const search = document.getElementById('search');

    const looksLikeColor = v => typeof v === 'string' && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(v);
    const looksLikeUrl = v => typeof v === 'string' && /^https?:\/\//i.test(v);
    const logoKeys = ['logo','logoUrl','logoURL','logo_url','icon','iconUrl'];

    function normalizeData(json){
      // Accept either {slug: {...}} or [{slug:'...', ...}, ...]
      if (Array.isArray(json)) return json;
      const out = [];
      for (const [slug, cfg] of Object.entries(json||{})) {
        if (cfg && typeof cfg === 'object') out.push({ slug, ...cfg });
      }
      return out;
    }

    function collectColumns(rows){
      const cols = new Set(['slug']);
      rows.forEach(r => Object.keys(r||{}).forEach(k => cols.add(k)));
      // Move some common columns to the front
      const pref = ['slug','name','brand','brandColor','buttonColor','primaryColor'];
      const ordered = [...cols].sort((a,b)=>{
        const ia = Math.max(0, pref.indexOf(a)), ib = Math.max(0, pref.indexOf(b));
        return (ia !== -1 ? ia : 999) - (ib !== -1 ? ib : 999) || a.localeCompare(b);
      });
      return ordered;
    }

    function render(rows) {
      const q = (search.value||'').trim().toLowerCase();
      const filtered = rows.filter(r => {
        const hay = (r.slug||'') + ' ' + (r.name||'') + ' ' + (r.brand||'');
        return hay.toLowerCase().includes(q);
      });

      const cols = collectColumns(filtered);

      // header
      thead.innerHTML = '<tr>' + cols.map(c => `<th class="text-left px-3 py-2 font-semibold">${c}</th>`).join('') + '</tr>';

      // rows
      tbody.innerHTML = filtered.map(r => {
        return '<tr>' + cols.map(c => {
          let v = r[c];
          // Logo cell
          if (logoKeys.includes(c) && looksLikeUrl(v)) {
            return `<td class="px-3 py-2"><img src="${v}" alt="${r.slug||''} logo" class="h-6 max-w-[160px] object-contain"/></td>`;
          }
          // Color swatch cell
          if (looksLikeColor(v)) {
            const color = v;
            return `<td class="px-3 py-2"><span class="inline-flex items-center gap-2">
              <span class="inline-block w-4 h-4 rounded" style="background:${color}"></span>
              <code>${color}</code></span></td>`;
          }
          // Objects/arrays -> stringify
          if (v && typeof v === 'object') {
            try { v = JSON.stringify(v); } catch(e) { v = String(v); }
          }
          if (v == null) v = '';
          return `<td class="px-3 py-2 text-slate-700">${String(v)}</td>`;
        }).join('') + '</tr>';
      }).join('');

      statusEl.textContent = `${filtered.length} company${filtered.length===1?'':'ies'} shown`;
    }

    async function load() {
      statusEl.textContent = 'Loading…';
      try {
        const res = await fetch(ENDPOINT, { headers: { 'Accept': 'application/json' }});
        if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
        const json = await res.json();
        window.__companies = normalizeData(json);
        render(window.__companies);
      } catch (err) {
        statusEl.textContent = 'Could not load themes.json (' + (err.message||err) + ').';
      }
    }

    document.getElementById('refresh').addEventListener('click', load);
    search.addEventListener('input', () => render(window.__companies||[]));
    load();
  </script>
</body>
</html>
